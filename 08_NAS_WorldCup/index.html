<!DOCTYPE html>
<html>
<title>Nebulas Fantasy</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karma">
<link href="css/bootstrap.min.css" rel="stylesheet">
<style>
    body,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        font-family: "Karma", sans-serif
    }

    .w3-bar-block .w3-bar-item {
        padding: 20px
    }

    .buyPlayer {
        margin: auto;
        width: 50%;
        padding: 10px;
    }

    img {
        display: block;
        margin: auto;
    }

    .howtoplay {
        font-weight: bold;
    }

    .sectionTitle {
        font-weight: bold;
        padding: 50px; 
    }

    .navbar {
        display:inline-block;
        list-style-type: none;
    }
</style>

<body>
    <!-- Sidebar (hidden by default) -->
    <!-- <nav class="w3-sidebar w3-bar-block w3-card w3-top w3-xlarge w3-animate-left" style="display:none;z-index:2;width:40%;min-width:300px"
        id="mySidebar">
        <a href="javascript:void(0)" onclick="w3_close()" class="w3-bar-item w3-button">Close</a>
        <a href="./players.html" onclick="w3_close()" class="w3-bar-item w3-button">Players</a>
        <a href="#howToPlay" onclick="w3_close()" class="w3-bar-item w3-button">How to Play</a>
        <a href="#about" onclick="w3_close()" class="w3-bar-item w3-button">About</a>
        <a href="#FAQ" onclick="w3_close()" class="w3-bar-item w3-button">FAQ</a>
    </nav> -->

    <div class="container">
        <div class="w3-white w3-xlarge" style="max-width:1200px;">
                <div class="w3-bar">
                        <a href="./index.html" class="w3-bar-item w3-button w3-mobile">Home</a>
                        <a href="./players.html" class="w3-bar-item w3-button w3-mobile">Portfolio</a>
                        <a href="./market.html" class="w3-bar-item w3-button w3-mobile">Market</a>
                        <a href="./about.html"  class="w3-bar-item w3-button w3-mobile">About</a>
                </div>
        </div>

        <header class="w3-display-container w3-content w3-wide" style="max-width:2000px;min-width:500px" id="home">
            <img class="w3-image" src="./img/banner0.png">
        </header>


        <div style="max-width:2000px;margin-top:50px">
            <div class="buyPlayer">
                <div>
                    <img class="img-center" id="randomPlayerCard" style="width:50%; height:50%;" src="./img/default card.png">
                    <button id="buyPlayer" type="button" class="btn btn-primary" style="display: block; margin: 20px auto;">
                        <h4> 0.1 NAS to CLAIM</h4>
                    </button>
                </div>
            </div>
        </div>



            <!-- About Section -->
            <div class="w3-padding-32 w3-center">
                <h2 class="sectionTitle">How To Play</h2>
                <div>
                    <div class="col-md-4">
                        <h4 class="howtoplay"> Claim Players</h4>
                        <img class="img-center" src="./img/home/create.png">
                        <br/>
                        <h5> You can either claim a random player, or pay premium to obtain your desired star. The amount of NAS you pay will enter into the prize pool</h5>
                    </div>
                    <div class="col-md-4">
                        <h4 class="howtoplay">Accumulate Points</h4>
                        <img class="img-center" src="./img/home/game.png">
                        <br/>
                        <h5> your players will gain experience points with real performance in the World Cup, e.g. 300pts for a winning game, 300pts for a goal.More points, More chance to win</h5>
                    </div>
                    <div class="col-md-4">
                        <h4 class="howtoplay">Get Reward</h4>
                        <img class="img-center" src="./img/home/win.png">
                        <br/>
                        <h5> When the World Cup ends, players with top 20 scores split the prize pool</h5>
                    </div>
                </div>
            </div>
 

            <br/>
            <div class="w3-container w3-padding-48 w3-center">

                <h2 class="sectionTitle">What is Nebulas Fantasy?</h2>
                <br>
                <p>here is some random words here is some random words here is some random words here is some random words
                    here is some random words here is some random words</p>
            </div>

                <!-- End page content -->
            </div>
            <script src=./lib/jquery-3.3.1.min.js></script>
            <script src="bootstrap.min.js"></script>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
            <script src=../lib/nebpay.js></script>
            <script src=../lib/nebulas.js></script>
            <script src='../lib/bignumber.min.js'></script>

            <script>
                // Script to open and close sidebar
                function w3_open() {
                    document.getElementById("mySidebar").style.display = "block";
                }

                function w3_close() {
                    document.getElementById("mySidebar").style.display = "none";
                }
            </script>

            <script>

                var nebulas = require("nebulas"),
                neb = new nebulas.Neb();
                var NebPay = require("nebpay");
                var nebPay = new NebPay();
                var serialNumber;
                Account = nebulas.Account;

                var mainnetUrl = "https://pay.nebulas.io/api/mainnet/pay",
                testnetUrl = "https://pay.nebulas.io/api/pay";

                const contractAddress = "n1yfeTXC8gMs2bJytb1nW2DnxUbgi911mm4";
                const ownerAddress = "n1RQYWMLqy1twJhfYxPk4SFx7wdfeq31pMX";
                neb.setRequest(new nebulas.HttpRequest("https://testnet.nebulas.io"));
                $("#address").attr('href', 'https://explorer.nebulas.io/#/testnet/address/' + contractAddress).attr('target', "_blank");
                var chainId = 1001;// test net
                var callbackUrl = testnetUrl;
                var explorerTx = "https://explorer.nebulas.io/#/testnet/tx/";


                // //main net 
                // const contractAddress = "n1kU44RRFoFvQbe8A6FAHDCC5APnfn89m2P";
                // const ownerAddress = "n1bveJ8tkb1DDECgHvknRFZesJqeaL2iKNt";
                // $("#address").attr('href','https://explorer.nebulas.io/#/mainnet/address/'+contractAddress).attr("target","_blank");
                // neb.setRequest(new nebulas.HttpRequest("https://mainnet.nebulas.io"));
                // var chainId = 1;// mainnet net
                // var callbackUrl = mainnetUrl;
                // //2ff9c00e3050f44dad190b1f5a6eb296ae6cdbed9007569db56fe2a054fc451c
                // var explorerTx = "https://explorer.nebulas.io/#/mainnet/tx/";
                // var explorer = "https://explorer.nebulas.io/#/address/";

                function init() {
                    var buyPlayer = $('#buyPlayer');
                    buyPlayer.click(buy);
                };

                function buy() {
                    var to = contractAddress;
                    var value = 0;// need to change
                    var callFunction = "mint";
                    var callArgs = "";
                    serialNumber = nebPay.call(to, value, callFunction, callArgs, {    //使用nebpay的call接口去调用合约,
                        listener: mintListener,        //设置listener, 处理交易返回信息
                    });
                }

                var txhash;

                function mintListener(resp) {
                    txhash = resp.txhash;
                    neb.api.getTransactionReceipt({
                        hash: resp.txhash
                    })
                        .then(function (receipt) {
                            console.log("receipt is:" + JSON.stringify(receipt))
                            setQuery = setInterval(function () {
                                setTxQuery();
                            }, 10000);
                        })
                }

                    function setTxQuery() {
                    neb.api.getTransactionReceipt({
                        hash: txhash
                    })
                        .then(function (receipt) {
                            console.log(receipt)
                            if (receipt.status ==1){
                                console.log("tx success")
                                var playerId = JSON.parse(receipt.execute_result);
                                console.log(playerId)
                                loadPlayerPicsById(playerId);
                                clearInterval(setQuery);
                            }

                           if (receipt.status ==0){
                                console.log("tx fail")
                                clearInterval(setQuery);
                            }
                            
                        })
                        .catch(function (err) {
                            console.log("didn't get a receipt")
                        })
                }

                function loadPlayerPicsById(id) {
                // Load pets.
                console.log(id);
                $.getJSON('./players.json', function(data) {
                    var playerCard = $('#randomPlayerCard');
                    playerCard.attr('src', data[id].picture);
                });

}


                $(window).load(function () {
                    // executes when complete page is fully loaded, including all frames, objects and images
                    init();
                });

            </script>

</body>

</html>