<!DOCTYPE html>
<html>

<head>
    <title> Batch Distribution</title>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<style>
        .myheader {
        text-align: center;
        color: black;
        font-size: 40px;
        margin: 30px;
        color: brown
    }

        .ownercontainer {
        overflow: hidden;
        margin: 0;
        padding: 20px;
        list-style: none;
        text-align: center;
    }
</style>


<body>
    <div class="myheader">
            <div>
                <h1>Nebulas Batch Transfer Machine </h1>
            </div>
    </div>

    <div class="ownercontainer">
        <div class="image">
        <img src="./img/logo-b.png">
        <div>
            <br>
            <br>
            <center style="border: blue">
                <input type="file" name="filename" id="filename" style="text-align: center">
                <button id="upload" onClick="upload()">upload</button>
            </center>
        </div>
    </div>

    <br>
    <br>
    <br>
    <!-- <form class=".form-control">
            <center style="border: blue">
                <input class=".form-control" type="file" name="filename" id="filename">
            </center>
            <br>
            <br>
            <button class=".form-group" id="upload" onClick="upload()">Upload</button>
        </form>

    <div class="csv"></div> -->
    

    <table class="table table-striped table-hover" id="here_table"> 
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col"> Eth Address</th>
                <th scope="col"> Verified?</th>
            </tr>
        </thead>
        <tbody id="tbody">
        </tbody>
    </table>


    <script src=../lib/jquery-3.3.1.min.js></script>
    <script src=../lib/bootstrap-4.0.0-dist/js/bootstrap.bundle.min.js data-depends=jquery.slim></script>
    <script src=../lib/js-beautify-1.7.5/beautify.js></script>
    <script src=../lib/nebpay.js></script>
    <script src=../lib/nebulas.js></script>
    
    <script>
    </script>
            


    <script>
        $("#here_table").hide(); 

        var nebulas = require("nebulas"),
            neb = new nebulas.Neb();
        var NebPay = require("nebpay");
        var nebPay = new NebPay();
        var serialNumber;
        
        Account = nebulas.Account;


        var mainnetUrl = "https://pay.nebulas.io/api/mainnet/pay",
        testnetUrl = "https://pay.nebulas.io/api/pay";


        // // test net
        const contractAddress = "n1haYJ4zitQujf4gUpTkgqkJ45d7zBQHbod";
        const ownerAddress = "n1RQYWMLqy1twJhfYxPk4SFx7wdfeq31pMX";
        neb.setRequest(new nebulas.HttpRequest("https://testnet.nebulas.io"));
        var chainId = 1001;// test net
        var callbackUrl = testnetUrl;

        //main net 
        // const contractAddress = "n1ge8uSwAQydvajytr2eJQWFjFc3BFUig82";
        // const ownerAddress = "n1bveJ8tkb1DDECgHvknRFZesJqeaL2iKNt";
        // $("#address").attr('href','https://explorer.nebulas.io/#/mainnet/address/'+contractAddress);
        // neb.setRequest(new nebulas.HttpRequest("https://mainnet.nebulas.io"));
        // var chainId = 1;// mainnet net
        // var callbackUrl = mainnetUrl;
        ////341b9046769341b4c2210b65907389839bbae78cb530e782f4834849f70f64c3
        

        var csvResult;
        function upload() {
            $("#here_table").show(); 
            $("#tbody").empty(); 
      
                var csv = $('#filename');
                var csvFile = csv[0].files[0];
                var ext = csv.val().split(".").pop().toLowerCase();
                if($.inArray(ext, ["csv"]) === -1){
                    alert('upload csv');
                    return false;
                }
                if(csvFile != undefined){
                    reader = new FileReader();
                    reader.onload = function(e){
                        csvResult = e.target.result.split(/\r|\n|\r/);
                        removeElement(csvResult,"");
                        removeElement(csvResult,"");
                        
                        showAddress(csvResult);
                    }
                    reader.readAsText(csvFile);
                }
        }


        function removeElement(arrayName,arrayElement)
        {
            for(var i=0; i<arrayName.length;i++ )
            { 
                if(arrayName[i]==arrayElement)
                    arrayName.splice(i,1); 
            } 
        }

        var isVerified;
        function showAddress(address){
            table_idx = 0;
            
            for (i=0;i<address.length;i++)
            {  
                if(Account.isValidAddress(address[i])){
                    isVerified = "Yes"
                }else{
                    isVerified = "No"
                }
                console.log(isVerified)

                $('#here_table').append( '<tr><th scope="row">'+table_idx+'</th>'+'<td>'+address[i] +'</td>'+'<td>'+isVerified +'</td></tr>');
                table_idx++;
             }
        }

        


    </script>
    
</body>

